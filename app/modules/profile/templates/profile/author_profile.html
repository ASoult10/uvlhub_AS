{% extends "base_template.html" %}

{% block title %}Explore{% endblock %}

{% block content %}

<h1 class="h2 mb-3"><b>Datasets authored by {{ user.profile.name }} {{ user.profile.surname }}</b></h1>

<div class="row">

    <h3 class="h3 mb-3">
        <span id="results_number"></span>
    </h3>

    <div class="col-lg-7 scrollable-column">


        <div class="row">
            {% if datasets_counter>0 %}
            <div id="results">
                {% for dataset in datasets %}
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                            <h2>

                                <a href="{{ dataset.get_uvlhub_doi() }}">
                                    {{ dataset.ds_meta_data.title }}
                                </a>

                            </h2>
                            <div>
                                <span class="badge bg-secondary">{{ dataset.get_cleaned_publication_type() }}</span>
                            </div>
                        </div>
                        <p class="text-secondary">{{ dataset.created_at.strftime('%B %d, %Y at %I:%M %p') }}</p>

                        <div class="row mb-2">

                            <div class="col-12">
                                <p class="card-text">{{ dataset.ds_meta_data.description }}</p>
                            </div>

                        </div>

                        <div class="row mb-2 mt-4">

                            <div class="col-12">
                                {% for author in dataset.ds_meta_data.authors %}
                                <p class="p-0 m-0">
                                    {{ author.name }}
                                    {% if author.affiliation %}
                                    ({{ author.affiliation }})
                                    {% endif %}
                                    {% if author.orcid %}
                                    ({{ author.orcid }})
                                    {% endif %}
                                </p>
                                {% endfor %}
                            </div>


                        </div>

                        <div class="row mb-2">

                            <div class="col-12">
                                <a href="{{ dataset.get_uvlhub_doi() }}">{{ dataset.get_uvlhub_doi() }}</a>
                                <div id="dataset_doi_uvlhub_{{ dataset.id }}" style="display: none">
                                    {{ dataset.get_uvlhub_doi() }}
                                </div>

                                <i data-feather="clipboard" class="center-button-icon" style="cursor: pointer"
                                    onclick="copyText('dataset_doi_uvlhub_{{ dataset.id }}')"></i>
                            </div>



                        </div>

                        <div class="row mb-2">

                            <div class="col-12">
                                {% for tag in dataset.ds_meta_data.tags.split(',') %}
                                <span class="badge bg-secondary">{{ tag.strip() }}</span>
                                {% endfor %}
                            </div>

                        </div>

                        <div class="row  mt-4">
                            <div class="col-12">
                                <a href="{{ dataset.get_uvlhub_doi() }}" class="btn btn-outline-primary btn-sm"
                                    style="border-radius: 5px;">
                                    <i data-feather="eye" class="center-button-icon"></i>
                                    View dataset
                                </a>

                                <a href="/dataset/download/{{ dataset.id }}" class="btn btn-outline-primary btn-sm"
                                    style="border-radius: 5px;">
                                    <i data-feather="download" class="center-button-icon"></i>
                                    Download ({{ dataset.get_file_total_size_for_human() }})
                                </a>
                            </div>
                        </div>

                        <!-- Recommendations Section -->
                        {% if recommendations_map and dataset.id in recommendations_map and
                        recommendations_map[dataset.id]|length > 0 %}
                        <div class="row mt-3">
                            <div class="col-12">
                                <h6 class="text-muted mb-2">
                                    <i data-feather="star" style="width: 16px; height: 16px;"></i> Similar Datasets
                                </h6>
                                {% for rec in recommendations_map[dataset.id] %}
                                <div class="mb-2">
                                    <a href="/doi/{{ rec.dataset.ds_meta_data.dataset_doi }}/"
                                        class="text-decoration-none">
                                        <div class="recommendation-card p-2 rounded"
                                            style="background-color: #f8f9fa; border-left: 3px solid #5700b3;">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <strong
                                                    style="color: #5700b3; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-right: 10px; font-size: 0.9rem;">
                                                    {% if rec.dataset.ds_meta_data.title|length > 50 %}
                                                    {{ rec.dataset.ds_meta_data.title[:50] }}...
                                                    {% else %}
                                                    {{ rec.dataset.ds_meta_data.title }}
                                                    {% endif %}
                                                </strong>
                                                <span class="badge"
                                                    style="background-color: #5700b3; font-size: 0.75rem; white-space: nowrap;">
                                                    {{ rec.score }}/10
                                                </span>
                                            </div>
                                            <small class="text-muted" style="font-size: 0.8rem;">
                                                {{ rec.downloads }} downloads Â· {{ rec.coincidences }} match{{ 'es' if
                                                rec.coincidences != 1 else '' }}
                                            </small>
                                        </div>
                                    </a>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}


                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="col text-center" id="results_not_found">
                <img src="{{ url_for('static', filename='img/items/not_found.svg') }}"
                    style="width: 50%; max-width: 100px; height: auto; margin-top: 30px" />
                <p style="margin-top: 20px">
                    This author does not have any datasets yet.
                </p>
            </div>

            <div id="results_not_found" style="text-align: center;">

            </div>
            {%endif%}

        </div>
    </div>

    {# Columna derecha #}
    <div class="col-xl-4 col-lg-12 col-md-12 col-sm-12">
        <div class="row">
            {# Informacion #}
            <div class="col-12">
                <div class="card">
                    <div class="card-body">

                        <h2> <b>Information</b> </h2>

                        <h1 class="h2 mb-3"></h1>

                        <h4 class="h4 mb-3" class="stats-color">
                            <i data-feather="users" class="align-middle mr-2 stats-color"></i>&nbsp;{{
                            profile.affiliation or 'Without affiliation'}}
                        </h4>
                        <h4 class="h4 mb-3" class="stats-color">
                            <i data-feather="hash" class="align-middle mr-2 stats-color"></i>&nbsp;{{ profile.orcid or
                            'Without ORCID' }}
                        </h4>

                    </div>

                </div>
                {# Estadisticas #}
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">

                            <h2> <b>Statistics</b> </h2>

                            <h1 class="h2 mb-3">

                                <h4 class="h4 mb-3" class="stats-color">
                                    <i data-feather="database" class="align-middle mr-2 stats-color"></i>&nbsp;{{
                                    datasets_counter }} datasets
                                </h4>

                            </h1>

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>


    {% endblock %}